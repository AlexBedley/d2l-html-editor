<link rel="import" href="d2l-html-editor-plugin.html">

<script>
	(function () {
		'use strict';
		/*global tinymce:true */
		/** @polymerBehavior */
		var EmoticonsBehavior = {
			plugin: {
				addPlugin: function () {
					tinymce.PluginManager.add('d2l_emoticons', function (editor) {
						const insertEmoticon = function (editor, src, alt) {
							editor.insertContent(editor.dom.createHTML('img', { src, alt }));
						};

						var emoticons = [
							['cool', 'cry', 'embarassed', 'foot-in-mouth'],
							['frown', 'innocent', 'kiss', 'laughing'],
							['money-mouth', 'sealed', 'smile', 'surprised'],
							['tongue-out', 'undecided', 'wink', 'yell']
						];

						function getHtml() {
							let emoticonsHtml;
							const pluginUrl = editor.documentBaseUrl + 'bower_components/d2l-html-editor';
							emoticonsHtml = '<table role="list" class="mce-grid">';
							tinymce.each(emoticons, function (row) {
								emoticonsHtml += '<tr>';
								tinymce.each(row, function (icon) {
									const emoticonUrl = pluginUrl + '/img/smiley-' + icon + '.gif';

									emoticonsHtml += '<td><a href="#" data-mce-url="' + emoticonUrl + '" data-mce-alt="' + icon + '" tabindex="-1" ' +
										'role="option" aria-label="' + icon + '"><img src="' +
										emoticonUrl + '" style="width: 18px; height: 18px" role="presentation" /></a></td>';
								});
								emoticonsHtml += '</tr>';
							});
							emoticonsHtml += '</table>';
							return emoticonsHtml;
						}

						editor.addButton('d2l_emoticons', {
							type: 'panelbutton',
							icon: 'emoticons',
							title: 'Emoticons',
							tooltip: 'Emoticons',
							panel: {
								autohide: true,
								html: getHtml(),
								onclick(e) {
									const linkElm = editor.dom.getParent(e.target, 'a');
									if (linkElm) {
										insertEmoticon(editor, linkElm.getAttribute('data-mce-url'), linkElm.getAttribute('data-mce-alt'));
										this.hide();
									}
								}
							}
						});
					});
				}
			}
		};

		window.D2LHtmlEditor = window.D2LHtmlEditor || {};
		window.D2LHtmlEditor.PolymerBehaviors = window.D2LHtmlEditor.PolymerBehaviors || {};
		/** @polymerBehavior */
		window.D2LHtmlEditor.PolymerBehaviors.Emoticons = EmoticonsBehavior;

	})();

</script>