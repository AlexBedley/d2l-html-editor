<link rel="import" href="d2l-html-editor-plugin.html">

<script>
(function() {
	'use strict';

	function command(service, editor) {
		var bookmark = editor.selection.getBookmark();
		service.click().then(function(response) {
			// setTimeout 10 required for IE to get focus back
			// document.activeELement.blur() required for Chrome to get focus back
			// moveToBookmark required by IE
			setTimeout(function() {
				document.activeElement.blur();
				editor.focus();
				editor.selection.moveToBookmark(bookmark);
				editor.execCommand('mceInsertContent', false, response);
			}, 10);
		}, function() {
			window.D2LHtmlEditor.PolymerBehaviors.Plugin.clearBookmark(editor, bookmark);			
		});
	}

	/** @polymerBehavior */
	var ImageBehavior = {
		plugin: {
			id: 'd2l_image',
			label: 'Add Image',
			icon: 'd2l_image',
			serviceId: 'fra-html-editor-image',
			cmd: command,
			init: function() {}
		}
	};

	window.D2LHtmlEditor = window.D2LHtmlEditor || {};
	window.D2LHtmlEditor.PolymerBehaviors = window.D2LHtmlEditor.PolymerBehaviors || {};
	/** @polymerBehavior */
	window.D2LHtmlEditor.PolymerBehaviors.Image = ImageBehavior;

})();
</script>
